dump.txt
각종 개발 내용 기록

# index
dump: 생각을 마구 적음
일정: 대략적인 일정
issue: 이슈들
mandatory: 반드시 필요한 구현
finish: 완료한 항목
implementation: 구체적인 구현
bonus: 추가적으로 적용할 수도 있는 구현
dump log: 사용한 dump 내용을 쌓아둔다

# dump
touch.location(in: self.view!) 는 값이 깔끔하게 나오는데
touch.location(in: self.camera!) 는 값이 지저분하게 나온다
하지만 화면에 적합하게 사이즈를 세팅하지 않았기 때문에
view 와 camera 가 서로 다른 단위 공간 벡터를 갖는다
당장은 오차가 다소 있어도 camera 기준으로 처리하지만,
이 문제를 해결할 아름다운 방법 생각하기

button touch 인식 방식 개선

tile 관련되서 enum 과 resource path 들을 Constant 에 다 넣어도 좋겠다
미끄러지는 방식을 더 자연스럽게 만들기
메뉴 화면을 만들자
world 를 만들고 초기화할 수 있다
월드의 갯수에 제한? 이름의 설정?
버튼의 선택은 굉장히 에니메이션스럽다

월드 입장 대기 화면
원하는 기능: 월드 입장, 초기화
월드에 입장할 때는 꿈 속에 들어가는 것 처럼 최면을 거는 듯이
    fade out fade in(시청각)
    빨려 들어가는 음악

월드 내에서의 메뉴
    월드 퇴장

저장할 데이터
타일 데이터: TileId[100][100]
타일 위의 오브젝트 데이터: GameObjectId[100][100]
캐릭터 데이터
    스킬 레벨
    인벤토리
    psychokinesis

캐릭터 원을 갈색보다 더 검은색으로 만들기

움직일 때 속도에 따른 자갈 밟는 소리
움직일 때 미세한 움직임에 부들부들 움직이면 보기 안좋을 수 있다
character node 는 ui? 에 속하도록 하자(실제 안움직임)
카메라는 실제 캐릭터가 항상 중심에 있도록 한다
isWalkable == false 인 타일 위를 움직일 때 빗겨가도록 움직이는 것을 어떻게 구현할까?
점토, 벽돌, 나무, 돌
밀가루, 벽돌, 점토, 밀, 나무, 물, 포도, 석탄
물
섬? 우주? 선택 가능
해머를 들고 상호작용 시 설치물의 내구를 파괴
고정 오브젝트 초기 맵
진행 바
update 안에서 lastTime 을 0.0 이 아닌 경우에 실행하도록 하는데, 내부에서 분기가 일어나지 않도록 개선할 수 있을까?

# 일정 및 진행 작업 기록
1주 2023-05-03 ~ 2023-05-09
계획 및 기초 개발
    2023-05-03 어떤 게임을 만들 것인지 구상
    2023-05-04 대략적인 기능 스케치
    2023-05-05
    2023-05-06 game object 및 앱 간단히 실행해보기
    2023-05-07 isWalkable 에 따른 캐릭터 이동 구현
    2023-05-08 간단한 데이터 모델과 저장, 초기화 기능 추가
    2023-05-09 게임 모델 구체화, 저장, 초기화 기능 구현

2주 2023-05-10 ~ 2023-05-16
베타 완료
    2023-05-10 DataController 추가
    2023-05-11 PortalScene 추가
    2023-05-12 WorldScene 에서 menu layer 추가
    2023-05-13 CoreData
    2023-05-14 save GameObject
    2023-05-15 remove GameObject
    2023-05-16 CoreData

3주 2023-05-17 ~ 2023-05-23
광고 추가, 컨텐츠 추가
    2023-05-17 DiskController
    2023-05-18 GameObjectDelegate, touch move
    2023-05-19 accessable object
    2023-05-20 collision
    2023-05-21 world border, reinforce touch
    2023-05-22
    2023-05-23

4주 2023-05-24 ~ 2023-05-30
리소스 생성, 테스트, 완성
    2023-05-24
    2023-05-25
    2023-05-26
    2023-05-27
    2023-05-28 정리
    2023-05-29 ppt 준비
    2023-05-30 마무리 

    2023-05-31 마감

# issue
craft cell touch not work
셀은 터치하면 필드 터치가 안되고 오브젝트는 터치하면 필드 터치가 되는데 혹시 오브젝트 크기가 0인가? 출력해보자
change the direction of craft display bottom to top
if i can consume third hand item, i want to possible to craft
sequenceiterator
the go in third hand must have 0.5 alpha
move interact to game object
make character class
move controller to scene
move files according to hierarchy
game object
    activate
    deactivate
button class
menu button class
menu window class
craft update
craft consume
craft add
prevent multi game object touch
    make class touch manager
ContainerNode 에서 new 를 하다니... 엉망이다
scene 의 touch 도 각 node 들로 옮겨야 한다
carry began should reset the status of GO
rename container node
field object touch 및 craft touch 중 캐릭터가 이동하여 타일이 바뀌면 경우에 따라서 취소시키기
    craft update 는 가능하면 터치중인 오브젝트를 고정시키기
    만약 없애야 한다면 크래프트 터치를 취소시키기
remove unneccessary return
craft
    consume ingredient
inventory object is always pickable
touoch pine cone make pine tree
touch wood wall break but not in inventory
InventoryNode -> InventoryPane
change portal button texture
set app icon
limit multi touch up to two

fix flick to persist direction
fix moving game object to out of world border

menu window touch
menu -> cancel all touch
save character position
PortalScene touch
add fade effect
add sound

터치 간의 상관 관계
    메뉴 버튼 터치 -> 드래그 중단
PortalScene 에 reset window 추가
interact 구현
    씨앗 -> 나무
    나무 맨손 -> 나뭇가지 or 씨앗
제작 구현
도끼 구현
WorldScene 에 exit button touch 구현
item drag 구현
손 이미지 추가
sound 구현 및 추가
    background
    interact
    button touch

WorldScene 에서 menu layer 추가
간단한 아이템 구현
{
    WorldScene 에서 터치에 따른 동작 구현
        터치에 따른 state machine 구상
    isWalkable 에 따른 캐릭터 이동 구현

    pan -> 이동 (1 개 제한)
    flick -> 미끄러지는 이동
    item pan -> 아이템 이동 (1 개 제한)
    button touch -> 기능 수행
    item touch -> interact(multi touch -> add queue)
}
아이템을 드래그해서 내려놓는 기능
    placeholder 를 보여주고 불가능하면 못내려 놓는다
데이터 관리
    캐릭터
        위치, 스킬
    바닥 아이템
    오브젝트
타일도 캐릭터의 위치 데이터와 마찬가지로 앱을 종료, 중단 시에 저장해도 충분할지 조사
sense message 구현

컨텐츠 추가
    나무
    도끼
    나무 바닥
    나무 벽
    망치
    돌맹이

enterButton, resetButton 맞춤 resource 제작

flow
    touch
data(memory, disk)
    TileMap, GameItem
structure
    MVC, class reference
```
├│─└


ViewController
├─ PortalSceneController
├─ WorldSceneController
```
character radius 이상의 거리를 1 프레임에 움직이면 벽을 뚫을 수 있다

# mandatory: 기대 시간(h) + 요구 사항
view
    game scene
        tileLayer
        gameObjectLayer
        uiLayer
            인벤토리(하단)
            메뉴(정지) 버튼(우측 상단)
            제작 버튼(롤코타처럼 버튼 누르면 서브 아이템 버튼 show) 제작 버튼은 흔하게 왼쪽에 세로로 두자

auto save
    6 구체화 및 구현
    일정 시간마다 자동 저장(변경이 발생할 때마다)

UI
    1 구체화하기
    layer: 바닥 > 벽 > 오브젝트
    바닥 타일은 모눈 회색 테두리를 가장 윗 레이어에 둬서 타일이 구분되도록 하자
    상호 작용 시 뽁 소리(입으로 녹음)

타일
    100 * 100 칸으로 일단 만들어보자
        상수 파일 분리(MAP_WIDTH_TILE_COUNT, MAP_HEIGHT_TILE_COUNT)

캐릭터
    이미지: 기본 이미지 + 모자 + 손 장비
    5 스킬
        도끼 제작 스킬
        나무 스킬
        밸런스
            살짝 불합리할 정도로 느리게, 종결은 좀 대단하다 싶을 정도로 과하게
    캐릭터가 위치한 타일과 인접한 8 타일을 터치하면 interaction 가능
        ex) 나무하기, 줍기
        상호작용 애니메이션
            도끼질: 손 기준 45 도 왕복 회전 일단 같은 속도 1 초 주기로

인벤토리
    인벤토리 크기는 5 칸

장비
    모자
    왼 손
    오른 손

아이템
    아이템은 합쳐지며 최대 99 개 제한(갯수는 아이템 이미지 우측 하단에 표시)
    아이템을 드래그하여 들 수 있다
    들고 있는 아이템을 내려 놓을 수 있다
        장비 칸
        인벤토리 다른 칸
        인접 타일 위
            캐릭터가 있는 타일
                만약 이미 아이템이 있다면?
                아이템이 버려지지 않고 드래깅 상태인 것으로 묘사한다
                    작은 원을 그리는 애니메이션
        내려 놓는 위치에 합칠 수 있으면 아이템을 뭉탱이로 합친다

GameObject
    Pickable: stone
        pick, interact, durability
    Interactable: tree
        interact
    Destroyable: building
        isWalkable = false, durability

4 sense message
    interaction 시 조건이 맞지 않을 때 무엇이 부족한지 출력(가장 위 레이어)
    fadein 1, 1.5, fadeout 0.5

컨트롤
    7 move: pan 하여 이동 적용(갈 수 있고 없고)
    7 interaction: 근처 타일 터치
    멀티 터치 가능
        한 손으로 팬하여 이동하면서
        다른 한 손으로 아이템을 들고 옮긴다
        touchMoved() 의 인자로 들어온 UITouch 인스턴스가 캐릭터 움직임에 사용되고 있는 터치인지 식별이 가능할까?

컨텐츠(이미지, 사운드) 생성 및 적용하기
    오브젝트의 타일 이미지와 인벤토리 이미지는 같은 것을 사용한다
    1 타일 배경
    1 배경 음악
    1 나무
    1 나무 씨앗
        심으면 현실 시간 몇 시간 후에 성장한다
    1 나무벽
    1 돌: 기본적으로 바닥에 떨어져 있다
    1 나뭇가지: 맨 손으로 나무와 상호작용하면 주변 빈 타일에 생성된다
    1 도끼: 나무와 상호작용하여 log 를 얻는다
    1 망치: 건물을 부순다

5 광고 추가하기
    화면 상단 일부
    깃에 올릴 것이므로 id 정보는 뺀 상태로 완성하기

3 앱 아이콘 만들고 적용하기

건설
    건설할 오브젝트를 드래그하여 캐릭터 주변에 드래그하면 회색으로 건설될 예정 모습을 보여준다
    드래그를 때면 건설이 되며 재료가 차감된다
    캐릭터가 건설 부지 위를 차지하고 있다면 예정 모습에 붉은 마스크를 해주자

스플래쉬 뷰?
    2 안드로이드에서 스플래쉬 뷰라고 불리는 초기 로딩 화면 설정하기

# finish
clean merged world scene
base type to none
set none texture to nil
trace
    WorldScene.updateAccessableGOs()
    WorldScene.updateCraftPane()
    WorldSceneController.addGOs()
    WorldSceneController.addGO()
    WorldSceneController.gameObjectToMO
    WorldScene.add() +1
    GameObjectMO.coordinate
    GameObjectMO.gameObjectCoordinate
setBlendFactor() 를 만들었다
    이제 지운 addAccessableGOs() 를 다시 append 로 교체하고 applyGOsUpdate() 를 호출하도록 수정하자
fix taht some object is below hand texture in inventory
increase accessable area node to cover the center of accessable tile
뭔가 item drag move 가 실패하는 경우가 있다..
container node 만들기
interact
remove unneccessary <Int>
accessable array 는 여기 저기서 호출
    - 타일 변경 등 잦은 호출
    - 월드 시작 시 호출
    - 아이템 생성 시 호출
game object touch -> alpha: 0.5
Container.gameobject add remove
Where to get the position of game object on field?
item is on third hand, move character, put down third hand to tile, pick up the item again, it trigger move touch
check tiletype() and containertype() optional check
remove GameObject
디스크 관리
    일단 데이터는 그대로 간다
    저장, 로드는 곳곳에서 한다
    단, 너무 깊숙하게는 말고, 가능하면 큰 변화가 확실한 곳에서 한다
ManagedObject -> MO
singleton -> lazy
inventoryNode: SKNode
fix not to drop third hand at posessed tile
remove WorldSceneController comment
when flick wall pass bug
isWalkable 구현
border collision
pickable non-pickable

# implementation
enum CompassDirection {
    case east
    case south
    case west
    case north
}

map
    tile[100][100]

tile
    image
    object
    side[4]

struct TileCoord {
    var x: Int
    var y: Int
}

class GameObject {
    var tilePosition: TileCoord?
    var isWalkable: Bool
    var isPickable: Bool
    var durability: Int
}

protocol Interactable {
    mutating interact(GameObject item)
}

protocol Destructible {
    destruct()
}

class Tree: GameObject, Interactable {
}

class Seed: GameObject, Pickable {
}

class Branch: GameObject, Pickable {
}

class Stone: GameObject, Pickable {
}

class Axe: GameObject, Pickable {
}

class Hammer: GameObject, Pickable {
}

# bonus
bounce flicked third hand item at the edge of screen
make object unstackable
상호작용 피드백
    사용된 인벤토리의 아이템이 회전
애니메이션 강화
    소모, 인벤토리 들어옴 등 피드백 시
오픈 월드 방식으로 데이터 관리하기
    chunk system
진행 방향으로 더 넓은 지역을 보여줬으면 좋겠다
멀티 가능
성능 향상
천장 구현
토끼
맵 랜덤 혹은 시드 생성
농사(괭이, 보리)
개선 사항
    화면에 적합한 비율의 리소스 사용
여러 월드 생성 가능
오브젝트를 드래그하는 상태에서 손가락을 떼지 않고 튕기면 반경 내에 그 방향으로 날라가는 상호작용
    오브젝트가 손가락에 가려지는 것을 막을 수 있다
아이템이 실수형 위치
    일정 거리 서로 밀어내도록
아이템도 튕기면 날아가게
메뉴 윈도우에 도움말 추가

# dump log
624B27 어두운 고동색
7C4D22 어두운 갈색
7F7F7F 어두운 회색
8A591E 어두운 갈색
CBCBCB 밝은 회색
E4B783 살구색

2023-05-07
다양한 화면 크기 대응
탑뷰
내 캐릭터는 타일 단위로 움직이지는 않는다
touchEnded() 에서 UITouch 의 location 값은 버리도록 하자
    이 값이 의미 있는 값을 갖는 경우 1 프레임에 값이 변한 것이기 때문에 버려도 큰 영향은 주지 않을 것이다. 그보다 사용할 경우 의미 있는 값을 갖고 있는지 판단하는 과정이 더 번거로울 것 같다
일단 이동을 단순히 구현하고 후에 디테일하게 하자
터치를 떼도 속도로 날라가고, 저항만큼 속도 감소
공부 더 필요하고 저번에 만든 코드 좀 보자
인벤은 많이는 말고 하단 마크처럼 몇 칸이 전부
멀티 터치 구현

2023-05-06
그래, 굳이 벽을 따로 만들 필요 없이 림월드나 마인크래프트처럼 벽도 타일 하나를 차지하도록 만드는 것이 복잡도 면에서 좋겠다

2023-05-05
인벤토리에서 제작하면?
그러면 아이템 내려놓는 거는 비슷하니까
안된다
버튼 효과음 뽁 입으로 녹음
움직이는 방향대로 팔을 흔드는 정도는 쉽다
하우징은 자유롭게
벽 같은 오브젝트는 인벤에 들어갈 수 없다
바닥에 설치한 것을 집을 수도 없다
파괴용 해머 좋다
타일맵으로 하자
오브젝트를 조사할 수 있다

2023-05-03 ~ 2023-05-04
propagation
주사위
어드벤처
압박하기
미니게임인데 다채로운

샌드박스는 리얼함이 포인트
rpg는 3d 정도는 되야 한다고 생각한다
가령 4 곱 4 칸이 있고 경우에 따라 순발력 있게 해당 칸을 클릭하여 문제를 해결하는 게임
우오우오우오우오우오우오우오오!
이미지 리소스는 단순하지만
패턴의 다양화로 지루하지 않다
쿵짝쿵짝쿵짝쿵짝쿵짝쿵짝쿵짝쿵-
쿵짝쿵짝쿵짝쿵짝쿵짝쿵짝쿵짝짝!
쿵짝쿵짝쿵짝쿵-쿵짝쿵짝쿵짝짝!
ㅇㅇㅇ-ㅇㅇㅇ-ㅇㅇㅇ-ㅇㅇㅇ-ㅇ-ㅇㅇㅇ-ㅇ-ㅇ
어려운 맵은 더 복잡한 배경 비트!
음악 게임도 리소스 싸움이다(이미지, 애니메이션, 사운드)
어차피 이도 저도 리소스가 많이 드는 것 같다
역시 전략 쪽으로 가야 리소스가 적게 든다(애니메이션도 필요가 없다)
만약 이 마져도 많이 든다고 생각한다면 내가 만들고 싶은 것을 조금이나마 만드는 것이 맞다
전략 퍼즐이 그나마 적은 리소스 -> 그렇다고 내가 원하지 않는 것을 만들어서는 안됨
역시 만들고 싶은건 한가한 샌드박스이다
그렇다고 석기시대부터 시작할 필요는 없다
자유!
팬으로 빠르게 돌아다니는 것을 허용
종이 그림 효과로 리소스 감소

직접 픽셀 크기를 정할 수 있게 하자
    그럼 화면은 최소 2 개
    스타트 화면과 게임 화면
블럭
    3x3 크기가 한 블럭
    블럭에 공장을 지을 수 있다

건물이 움직인다
건물을 지을 때 뽁 하는 효과
복사 붙여넣기 중요

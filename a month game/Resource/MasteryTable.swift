//
//  MasteryTable.swift
//  a month game
//
//  Created by 박정훈 on 2023/07/10.
//

import Foundation
import UIKit

enum TaskResultType: Int {

    case fail
    case poor
    case common
    case rare

    var exp: Int { self.rawValue }
    var qualityDiff: Double { Double(self.rawValue - 2) }


    var color: UIColor {
        let alpha = 0.7
        
        switch self {
        case .rare:
            return .yellow.withAlphaComponent(alpha)
        case .common:
            let color = 192.0 / 255.0
//            let color = 81.5 / 255.0
            return UIColor(red: color, green: color, blue: color, alpha: alpha)
        case .poor:
            return .brown.withAlphaComponent(alpha)
        case .fail:
            return .black.withAlphaComponent(alpha)
        }
    }

//    case .rare:
//    case .common:
//    case .poor:
//    case .fail:

}

struct MasteryTable {

    typealias TableElement = (
        rare: Double,
        common: Double,
        poor: Double,
        fail: Double,
        expForNextLv: Int
    )

    static func result(lv: Int) -> TaskResultType {
        let probability = Double.random(in: 0.0 ... 100.0)

        let lvInfo = self.table[lv]

        if probability < lvInfo.rare {
            return .rare
        } else if probability < lvInfo.common {
            return .common
        } else if probability < lvInfo.poor {
            return .poor
        } else if probability < lvInfo.fail {
            return .fail
        }

        fatalError("MasteryTable::result(lv:) failed")
    }

    static let table: [TableElement] = [
        ( 0.00,   0.00,  60.00, 100.00,       1),
        ( 0.50,   4.50,  64.00, 100.00,       2),
        ( 1.00,   9.00,  68.00, 100.00,       3),
        ( 1.50,  13.50,  72.00, 100.00,       4),
        ( 2.00,  18.00,  76.00, 100.00,       6),
        ( 2.50,  22.50,  80.00, 100.00,       8),
        ( 3.00,  27.00,  84.00, 100.00,      10),
        ( 3.50,  31.50,  88.00, 100.00,      12),
        ( 4.00,  36.00,  92.00, 100.00,      15),
        ( 4.50,  40.50,  96.00, 100.00,      18),
        ( 5.00,  45.00, 100.00, 100.00,      21),
        ( 5.50,  45.50, 100.00, 100.00,      25),
        ( 6.00,  46.00, 100.00, 100.00,      29),
        ( 6.50,  46.50, 100.00, 100.00,      34),
        ( 7.00,  47.00, 100.00, 100.00,      40),
        ( 7.50,  47.50, 100.00, 100.00,      46),
        ( 8.00,  48.00, 100.00, 100.00,      53),
        ( 8.50,  48.50, 100.00, 100.00,      61),
        ( 9.00,  49.00, 100.00, 100.00,      70),
        ( 9.50,  49.50, 100.00, 100.00,      80),
        (10.00,  50.00, 100.00, 100.00,      92),
        (10.50,  50.50, 100.00, 100.00,     105),
        (11.00,  51.00, 100.00, 100.00,     120),
        (11.50,  51.50, 100.00, 100.00,     136),
        (12.00,  52.00, 100.00, 100.00,     155),
        (12.50,  52.50, 100.00, 100.00,     176),
        (13.00,  53.00, 100.00, 100.00,     200),
        (13.50,  53.50, 100.00, 100.00,     227),
        (14.00,  54.00, 100.00, 100.00,     258),
        (14.50,  54.50, 100.00, 100.00,     293),
        (15.00,  55.00, 100.00, 100.00,     332),
        (15.50,  55.50, 100.00, 100.00,     376),
        (16.00,  56.00, 100.00, 100.00,     426),
        (16.50,  56.50, 100.00, 100.00,     482),
        (17.00,  57.00, 100.00, 100.00,     546),
        (17.50,  57.50, 100.00, 100.00,     618),
        (18.00,  58.00, 100.00, 100.00,     700),
        (18.50,  58.50, 100.00, 100.00,     792),
        (19.00,  59.00, 100.00, 100.00,     896),
        (19.50,  59.50, 100.00, 100.00,    1013),
        (20.00,  60.00, 100.00, 100.00,    1146),
        (20.50,  60.50, 100.00, 100.00,    1296),
        (21.00,  61.00, 100.00, 100.00,    1466),
        (21.50,  61.50, 100.00, 100.00,    1657),
        (22.00,  62.00, 100.00, 100.00,    1874),
        (22.50,  62.50, 100.00, 100.00,    2118),
        (23.00,  63.00, 100.00, 100.00,    2395),
        (23.50,  63.50, 100.00, 100.00,    2707),
        (24.00,  64.00, 100.00, 100.00,    3060),
        (24.50,  64.50, 100.00, 100.00,    3459),
        (25.00,  65.00, 100.00, 100.00,    3910),
        (25.50,  65.50, 100.00, 100.00,    4419),
        (26.00,  66.00, 100.00, 100.00,    4995),
        (26.50,  66.50, 100.00, 100.00,    5645),
        (27.00,  67.00, 100.00, 100.00,    6380),
        (27.50,  67.50, 100.00, 100.00,    7210),
        (28.00,  68.00, 100.00, 100.00,    8149),
        (28.50,  68.50, 100.00, 100.00,    9209),
        (29.00,  69.00, 100.00, 100.00,   10407),
        (29.50,  69.50, 100.00, 100.00,   11761),
        (30.00,  70.00, 100.00, 100.00,   13292),
        (30.50,  70.50, 100.00, 100.00,   15020),
        (31.00,  71.00, 100.00, 100.00,   16974),
        (31.50,  71.50, 100.00, 100.00,   19182),
        (32.00,  72.00, 100.00, 100.00,   21677),
        (32.50,  72.50, 100.00, 100.00,   24496),
        (33.00,  73.00, 100.00, 100.00,   27681),
        (33.50,  73.50, 100.00, 100.00,   31281),
        (34.00,  74.00, 100.00, 100.00,   35348),
        (34.50,  74.50, 100.00, 100.00,   39945),
        (35.00,  75.00, 100.00, 100.00,   45139),
        (35.50,  75.50, 100.00, 100.00,   51008),
        (36.00,  76.00, 100.00, 100.00,   57640),
        (36.50,  76.50, 100.00, 100.00,   65134),
        (37.00,  77.00, 100.00, 100.00,   73602),
        (37.50,  77.50, 100.00, 100.00,   83172),
        (38.00,  78.00, 100.00, 100.00,   93985),
        (38.50,  78.50, 100.00, 100.00,  106204),
        (39.00,  79.00, 100.00, 100.00,  120012),
        (39.50,  79.50, 100.00, 100.00,  135614),
        (40.00,  80.00, 100.00, 100.00,  153245),
        (40.50,  80.50, 100.00, 100.00,  173168),
        (41.00,  81.00, 100.00, 100.00,  195681),
        (41.50,  81.50, 100.00, 100.00,  221121),
        (42.00,  82.00, 100.00, 100.00,  249868),
        (42.50,  82.50, 100.00, 100.00,  282352),
        (43.00,  83.00, 100.00, 100.00,  319058),
        (43.50,  83.50, 100.00, 100.00,  360537),
        (44.00,  84.00, 100.00, 100.00,  407408),
        (44.50,  84.50, 100.00, 100.00,  460372),
        (45.00,  85.00, 100.00, 100.00,  520221),
        (45.50,  85.50, 100.00, 100.00,  587851),
        (46.00,  86.00, 100.00, 100.00,  664273),
        (46.50,  86.50, 100.00, 100.00,  750629),
        (47.00,  87.00, 100.00, 100.00,  848212),
        (47.50,  87.50, 100.00, 100.00,  958481),
        (48.00,  88.00, 100.00, 100.00, 1083085),
        (48.50,  88.50, 100.00, 100.00, 1223887),
        (49.00,  89.00, 100.00, 100.00, 1382993),
        (49.50,  89.50, 100.00, 100.00, Int.max),
    ]

}
